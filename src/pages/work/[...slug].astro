---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const workEntries = await getCollection('work');
  return workEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;

if (!entry) {
    throw new Error('Entry not found in props');
}

let Content;
try {
    const renderResult = await entry.render();
    Content = renderResult.Content;
} catch (e) {
    console.error('Error rendering entry:', e);
    throw e;
}

const { title, client, publishDate, cover, coverAlt, role, engagement, team, stack, liveUrl, tags } = entry.data;

const formattedDate = publishDate ? publishDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' }) : 'Date Unknown';
const year = formattedDate.split(' ')[1] || formattedDate;
---

<Layout title={`${title} | Juan M. Rodriguez`}>
  <article class="min-h-screen bg-white">
    
    <!-- Case Study Hero -->
    <header class="pt-32 pb-16 px-6 md:px-12 max-w-7xl mx-auto border-b border-zinc-100">
      <div class="flex flex-col gap-6">
        <div class="flex flex-wrap gap-2 mb-4">
          {tags && tags.map(tag => (
             <span class="px-2 py-1 text-xs uppercase tracking-wider text-zinc-500 border border-zinc-200 rounded-sm">
               {tag}
             </span>
          ))}
        </div>
        
        <h1 class="font-display text-5xl md:text-7xl font-bold text-zinc-900 tracking-tight">
          {title}
        </h1>

        <div class="flex flex-col md:flex-row md:items-center justify-between gap-8 mt-8">
            <div class="flex gap-8 md:gap-16">
                <div>
                    <span class="block text-xs text-zinc-400 uppercase tracking-widest mb-1">Client</span>
                    <span class="font-sans text-zinc-900">{client}</span>
                </div>
                <div>
                    <span class="block text-xs text-zinc-400 uppercase tracking-widest mb-1">Role</span>
                    <span class="font-sans text-zinc-900">{role}</span>
                </div>
                <div>
                    <span class="block text-xs text-zinc-400 uppercase tracking-widest mb-1">Year</span>
                    <span class="font-sans text-zinc-900">{year}</span>
                </div>
            </div>
            
            {liveUrl && (
                <a href={liveUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 px-6 py-3 bg-zinc-900 text-white text-sm font-medium hover:bg-zinc-800 transition-colors rounded-sm">
                    Visit Live Site 
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right"><path d="M7 7h10v10"/><path d="M7 17 17 7"/></svg>
                </a>
            )}
        </div>
      </div>
    </header>

    <!-- Cover Image -->
    <div class="w-full h-[50vh] md:h-[70vh] overflow-hidden bg-zinc-100">
        <img src={cover} alt={coverAlt} class="w-full h-full object-cover" />
    </div>

    <!-- Content Grid -->
    <div class="max-w-7xl mx-auto px-6 md:px-12 py-20 grid grid-cols-1 md:grid-cols-12 gap-12">
        
        <!-- Sidebar Meta -->
        <aside class="md:col-span-4 lg:col-span-3 flex flex-col gap-12">
            
            <div>
                <h3 class="font-display text-lg font-bold text-zinc-900 mb-4 border-b border-zinc-100 pb-2">Engagement</h3>
                <ul class="space-y-2 text-sm text-zinc-600">
                    <li class="flex justify-between"><span>Type</span> <span class="text-zinc-900">{engagement}</span></li>
                    <li class="flex justify-between"><span>Team</span> <span class="text-zinc-900">{team}</span></li>
                </ul>
            </div>

            <div>
                <h3 class="font-display text-lg font-bold text-zinc-900 mb-4 border-b border-zinc-100 pb-2">Tech Stack</h3>
                <div class="flex flex-col gap-4">
                    <div>
                        <span class="text-xs text-zinc-400 uppercase tracking-wider block mb-2">Frontend</span>
                        <div class="flex flex-wrap gap-2">
                            {stack.frontend.map(item => <span class="text-sm text-zinc-600 bg-zinc-50 px-2 py-1 rounded-sm">{item}</span>)}
                        </div>
                    </div>
                    {stack.backend && (
                        <div>
                            <span class="text-xs text-zinc-400 uppercase tracking-wider block mb-2">Backend</span>
                            <div class="flex flex-wrap gap-2">
                                {stack.backend.map(item => <span class="text-sm text-zinc-600 bg-zinc-50 px-2 py-1 rounded-sm">{item}</span>)}
                            </div>
                        </div>
                    )}
                </div>
            </div>

        </aside>

        <!-- Main Prose -->
        <div class="md:col-span-8 lg:col-span-8 lg:col-start-5">
            <div class="prose prose-zinc prose-lg max-w-none prose-headings:font-display prose-headings:font-bold prose-p:text-zinc-600 prose-p:leading-relaxed prose-a:text-zinc-900 prose-a:underline hover:prose-a:text-zinc-600 prose-blockquote:border-l-2 prose-blockquote:border-zinc-900 prose-blockquote:pl-6 prose-blockquote:italic">
                <Content />
            </div>
        </div>

    </div>
    
    <!-- Footer Navigation (Simple Back) -->
    <div class="border-t border-zinc-100 py-12 px-6 md:px-12 text-center">
        <a href="/#selected-work" class="text-zinc-500 hover:text-zinc-900 transition-colors text-sm font-medium">‚Üê Back to Selected Work</a>
    </div>

  </article>
</Layout>
